!async function(){console.log("CarbonClicks initialised");let ip,city,region,country_code3,carbonClicks={length:0};setInterval((()=>{carbonClicks.length+=200}),200),carbonClicks.resources=[],carbonClicks.events=[],carbonClicks.totalTransfer=0,carbonClicks.referrer=document.referrer,carbonClicks.urlHash="",carbonClicks.green=!1,new PerformanceObserver((list=>{list.getEntries().forEach((entry=>{if("fetch"==entry.initiatorType)return;let resource={url:entry.name,date:(new Date).toISOString(),type:entry.initiatorType,duration:Math.round(entry.duration),transfer_size:Math.round(entry.encodedBodySize),optimised_size:0};switch(resource.t){case"img":let htmlImg=document.querySelector(`[src="${resource.u}"]`);resource.optimised_size=htmlImg?((width,height)=>{let area=width*height;if(area<1)return 200;let optimised=(area/24+area/1e3)/(180+area/10/1e3),result=Number((optimised+optimised/100*20).toFixed(2));return result<1?1:result})(htmlImg.offsetWidth,htmlImg.offsetHeight):204800;break;case"link":case"script":resource.optimised_size=153600;break;case"other":resource.optimised_size=76800;break;default:resource.optimised_size=204800}carbonClicks.resources.push(resource),carbonClicks.totalTransfer+=resource.ts}))})).observe({type:"resource",buffered:!0}),carbonClicks.endpoint=document.querySelector("[data-carbon-clicks-endpoint]").getAttribute("data-carbon-clicks-endpoint")??"https://carbonclicks.io/public/api/analytics",await fetch("https://api.seeip.org/geoip",{method:"GET"}).then((res=>!!res.ok&&res.json())).then((async res=>{res&&(ip=res.ip,city=res.city,region=res.region,country_code3=res.country_code3,carbonClicks.country=country_code3,carbonClicks.id=await async function(ip){let userAgent=Navigator.userAgent,buffer=new TextEncoder("utf-8").encode(ip+userAgent),hash=await crypto.subtle.digest("SHA-512",buffer);return Array.from(new Uint8Array(hash)).map((b=>b.toString(16).padStart(2,"0"))).join("")}(ip))}));let domain=window.location.href;domain.startsWith("http")&&(domain=domain.split("/")[2]),await fetch(`https://admin.thegreenwebfoundation.org/api/v3/greencheck/${domain}`).then((async res=>!!res.ok&&await res.json())).then((res=>{res&&(carbonClicks.green=!!res?.green&&res.green)})),carbonClicks.lastHref=window.location.href;let dataSent=!1;carbonClicks.scroll=!1,document.addEventListener("visibilitychange",(function(){"hidden"!==document.visibilityState&&1!=document.hidden||!1!==dataSent?!0===dataSent&&(dataSent=!1):(carbonClicks.send_data(),dataSent=!0)})),document.addEventListener("beforeunload",(function(){!1===dataSent&&(carbonClicks.send_data(),dataSent=!0)})),document.addEventListener("click",(function(e){setTimeout((()=>{carbonClicks.lastHref!=window.location.href&&(carbonClicks.send_data(),dataSent=!1,carbonClicks.length=0,carbonClicks.lastHref=window.location.href)}),500)}));let currentMouseoverTarget="";document.addEventListener("mouseover",(function(e){currentMouseoverTarget=e.target,setTimeout((()=>{e.target}),600)})),document.addEventListener("ontouchstart",(function(e){})),document.addEventListener("scroll",(function(e){carbonClicks.scroll=!0})),carbonClicks.accountId=document.querySelector("[data-carbon-clicks-id]").getAttribute("data-carbon-clicks-id")??"";const get_path=function(){let loc=window.location.href;return loc.startsWith("http")&&(loc=loc.split("://")[1]),loc.startsWith("www")&&(loc=loc.replace(/^www\./,"")),loc=loc.split("/"),loc.splice(0,1),loc=loc.join("/"),""!=loc?loc:"/"};function is_bot(){let w=window,d=document;return!!(w.callPhantom||w._phantom||w.phantom)||(!!w.__nightmare||(!!(d.__selenium_unwrapped||d.__webdriver_evaluate||d.__driver_evaluate)||(!!navigator.webdriver||window.navigator.userAgent.search(/(bot|spider|crawl)/gi)>-1)))}carbonClicks.title=document.title??"",carbonClicks.get_query=function(name){let s=location.search.substr(1).split("&");for(let i=0;i<s.length;i++)if(0===s[i].toLowerCase().indexOf(name.toLowerCase()+"="))return s[i].substr(name.length+1)},carbonClicks.send_data=function(){let data=function(){let[navs]=performance.getEntriesByType("navigation"),data={id:carbonClicks.id,account_id:carbonClicks.accountId,date:(new Date).toISOString(),url:window.location.href,url_hash:carbonClicks.urlHash,path:get_path(),referrer:carbonClicks.referrer,title:carbonClicks.title,events:carbonClicks.events,screen_width:Math.round(window.screen.width),screen_height:Math.round(window.screen.height),device_pixel_ratio:window.devicePixelRatio||1,session_length:carbonClicks.length,scroll:carbonClicks.scroll,bot:is_bot(),query:location.search?location.search:"",transfer:Math.round(carbonClicks.totalTransfer),country:carbonClicks.country,dom_interactive:Math.round(navs.domInteractive),dom_complete:Math.round(navs.domComplete),dom_load_event_end:Math.round(navs.loadEventEnd),resources:carbonClicks.resources,green:carbonClicks.green,user_agent:window.navigator.userAgent};return JSON.stringify(data)}(),url=carbonClicks.endpoint;console.log("carbonclicks sending data"),fetch(url,{method:"POST",keepalive:!0,headers:{"Content-Type":"application/json"},body:data}),carbonClicks.length=0,carbonClicks.events=[]}}();